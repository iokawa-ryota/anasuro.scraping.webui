# テストチェックリスト（複数観点）

このドキュメントは、本プロダクトの主要機能を複数観点で確認するための一覧です。  
対象フローは「店舗指定 -> HTML保存 -> CSV変換」です。

## 運用ルール

- [ ] テスト実行後、`_internal/test/TEST_RESULTS_YYYY-MM-DD.md` の結果サマリを最新状態に更新する
- [ ] 不合格項目を修正して再テストした場合、初回結果と再テスト結果の両方をサマリに明記する

## 1. セットアップ観点

- [ ] `setup.bat` 実行でセットアップが最後まで完了する
- [ ] Python未導入環境で、エラー文言が分かりやすく表示される
- [ ] 必要ディレクトリ（`output/`, `_internal/runtime/`）が自動作成される
- [ ] `store_list.csv` がない場合に異常終了し、原因が表示される

## 2. 起動・基本動作観点

- [ ] `start.bat` 実行でWeb画面が利用可能になる（`http://localhost:5000`）
- [ ] トップ画面表示に失敗した場合、エラーを返す
- [ ] アプリ起動直後に店舗一覧が正しく読み込まれる

## 3. 店舗設定観点（Web UI）

- [ ] 店舗設定を画面で保存すると `store_list.csv` に反映される
- [ ] 空の店舗名で保存した場合、自動で店舗名が補完される
- [ ] 店舗並び替えを保存するとCSV順序が更新される
- [ ] 不正な保存リクエストで400/500が適切に返る

## 4. スクレイピング観点（HTML保存）

- [ ] 店舗を1件選択して実行すると、対象店舗のHTMLが `data/` 配下に保存される
- [ ] 複数店舗選択時、全店舗分の処理が順番に進行する
- [ ] 店舗未選択で実行した場合、エラーを返す
- [ ] 選択店舗が存在しない場合、エラーを返す
- [ ] 長時間遷移停止時、監視タイムアウトで中断し失敗表示になる

## 5. 進捗・ジョブ管理観点

- [ ] `/api/scrape` 実行で `job_id` が返る
- [ ] `/api/jobs/<job_id>` で進捗率・状態・メッセージが更新される
- [ ] 正常終了時に `status=completed` かつ `progress=100` になる
- [ ] 異常終了時に `status=failed` と原因メッセージが残る

## 6. オフライン整形観点（CSV変換）

- [ ] `/api/format-offline` 実行でCSV変換が走る
- [ ] 変換後CSVが `output/` 配下に出力される
- [ ] 長時間処理時に202応答を返し、処理中として扱える
- [ ] 変換失敗時にエラーメッセージが返る

## 7. データ品質観点

- [ ] CSV列名が仕様どおり（`total` など）で出力される
- [ ] 既存形式（`Total`）の入力でも互換処理できる
- [ ] 文字コード違いの `store_list.csv`（UTF-8/UTF-8-SIG/CP932）を読み込める
- [ ] 店舗件数が多い場合でも、欠損や重複が不自然に増えない

## 8. ログ・追跡性観点

- [ ] スクレイピング実行ログが `_internal/runtime/scraping_log.json` に追記される
- [ ] `/api/logs` で直近ログを取得できる
- [ ] 整形実行時に完了店舗情報がログに残る

## 9. 障害復旧観点

- [ ] スクレイピング途中でプロセス終了しても、再起動後に再実行できる
- [ ] 途中で生成された一時ファイルが残っていても次回実行が妨げられない
- [ ] 失敗後に店舗設定を変更して再実行できる

## 10. 互換性・配布観点

- [ ] Windows標準環境で手順どおりに操作できる（非エンジニア想定）
- [ ] ルート直下の導線（`setup.bat` / `start.bat`）だけで運用できる
- [ ] `_internal/` を触らなくても通常運用できる

## 11. セキュリティ・安全性観点

- [ ] APIに想定外の型を送った場合に安全にエラー処理される
- [ ] 例外発生時に機密情報（ローカル環境情報など）を過剰に返さない
- [ ] 保存先パスに不正な値を入れても危険な書き込みが起きない

## 12. パフォーマンス観点

- [ ] 店舗数1件/10件/50件で実行時間の目安を記録する
- [ ] API応答が極端に遅くならない（ジョブ起票まで数秒以内）
- [ ] ログ蓄積時も画面操作とAPI取得が実用速度を維持する

## 13. UI E2E 観点（Playwright）

- [ ] 店舗設定パネルを開ける
- [ ] 店舗削除モーダル（キャンセル/確定）が想定どおり動作する
- [ ] 店舗設定を追加して保存すると成功メッセージが表示される
